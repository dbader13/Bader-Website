{{ $item := .item }}
{{ $has_attachments := partial "functions/has_attachments" $item }}

<div class="media stream-item view-compact">
  <div class="media-body">

    <div class="section-subheading article-title mb-0 mt-0">
      <a href="{{ $item.RelPermalink }}">{{ $item.Title }}</a>
    </div>

    {{ if eq $item.Type "events" }}
      {{/* For events, show abstract, date/time, and location */}}
      {{ with $item.Params.abstract }}
      <div class="article-style">
        {{ . | truncate 250 }}
      </div>
      {{ end }}

      <div class="stream-meta article-metadata">
        {{ with $item.Date }}
          {{ .Format "Jan 2, 2006 3:04 PM" }}
          {{ with $item.Params.date_end }}
            {{ $end_time := time . }}
            &mdash; {{ $end_time.Format "3:04 PM" }}
          {{ end }}
        {{ end }}
        
        {{ with $item.Params.location }}
          &nbsp;&middot;&nbsp; {{ . }}
        {{ end }}
      </div>
    {{ else }}
      {{/* For other content types (publications, etc.) */}}
      {{ with $item.Params.authors }}
      <div class="article-metadata">
        {{ delimit . ", " }}
      </div>
      {{ end }}

      {{ if $item.Params.publication }}
      <div class="article-metadata">
        {{ $item.Params.publication | markdownify }}
      </div>
      {{ end }}

      <div class="article-metadata">
        {{ partial "page_metadata" (dict "page" $item "is_list" 1) }}
      </div>

      {{ with $item.Params.abstract }}
      <div class="stream-meta article-metadata">
        {{ . | truncate 135 }}
      </div>
      {{ end }}
    {{ end }}

  </div>
  <div class="ml-3">
    {{ $resource := ($item.Resources.ByType "image").GetMatch "*featured*" }}
    {{ with $resource }}
    {{ $image := .Resize "150x webp" }}
    <a href="{{ $item.RelPermalink }}">
      <img src="{{ $image.RelPermalink }}" height="{{ $image.Height }}" width="{{ $image.Width }}"
           alt="{{ $item.Title }}" loading="lazy">
    </a>
    {{end}}
  </div>
</div>
